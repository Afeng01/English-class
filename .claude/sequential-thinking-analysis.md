# 需求深度分析

## 用户需求原文
1. 点击单词（如ceiling）不显示正确含义
2. 建议添加默认词库功能，包含常见词（如the, apple等），用于在阅读时用不同颜色标注单词的熟悉程度

## 问题本质分析

### 问题1：点击单词不显示正确含义
**表象**：用户点击"ceiling"这个词，但没有显示正确的释义
**可能的本质问题**：
- 词典数据源问题（缺失该单词的释义）
- 单词匹配逻辑问题（大小写、词形变化）
- 前端显示逻辑问题（数据获取成功但未正确展示）
- 数据库查询问题（查询条件或索引问题）

### 问题2：默认词库功能
**表象**：需要预设一个词汇等级系统，对常见词进行分类标注
**本质需求**：
- 词汇分级体系（基础词/常见词/高级词）
- 视觉反馈系统（不同颜色代表不同熟悉度）
- 个性化学习路径（根据用户水平调整显示）

## 可能的技术原因（问题1）

### 数据层面
1. 词典数据不完整（ceiling 这个词未录入）
2. 词形变化处理不当（如：ceiling vs. ceilings）
3. 大小写敏感性问题
4. 特殊字符处理问题

### 查询层面
1. SQL 查询逻辑错误
2. 索引未优化导致查不到
3. 查询参数传递错误
4. 返回数据格式异常

### 前端展示层面
1. 数据绑定失败
2. 条件渲染逻辑错误
3. 异步数据加载时序问题
4. UI 组件状态管理问题

## 需要探索的代码模块

### 模块1：单词点击事件处理
- 事件监听器位置
- 单词提取逻辑
- 查询请求构建

### 模块2：词典查询服务
- API 路由定义
- 数据库查询逻辑
- 数据预处理/后处理

### 模块3：释义显示组件
- 数据接收和状态管理
- 渲染逻辑
- 错误处理

### 模块4：词典数据结构
- 数据库 schema
- 词典数据来源
- 数据导入/更新机制

## 默认词库功能设计考虑点

### 功能性考虑
1. **词汇分级标准**：
   - 采用什么标准？（CEFR/CET/IELTS/自定义）
   - 分几个等级？
   - 每个等级包含多少词？

2. **颜色编码方案**：
   - 几种颜色？（建议3-5种）
   - 颜色语义（绿色=已掌握，黄色=认识，红色=生词）
   - 色盲友好性考虑

3. **词库数据来源**：
   - 使用现成词表（如 Oxford 3000）
   - 自定义词表
   - 多词表支持

### 技术性考虑
1. **数据存储**：
   - 默认词库存在哪里？（数据库/静态文件）
   - 用户个性化词库如何存储？
   - 数据同步机制

2. **性能优化**：
   - 大量单词的颜色标注性能
   - 词汇查找效率（Hash/Trie）
   - 渲染优化（虚拟滚动/分批渲染）

3. **用户体验**：
   - 是否可自定义等级？
   - 是否支持手动调整单词等级？
   - 学习进度追踪

## 关键技术疑问（优先级排序）

### 高优先级（必须立即解决）
1. **[P0] ceiling 单词为何不显示释义？**
   - 需要确认：数据库中是否有该词？
   - 需要确认：查询逻辑是否正确？
   - 需要确认：前端是否正确接收和显示数据？

2. **[P0] 项目当前使用的词典数据源是什么？**
   - 是自建词典还是第三方 API？
   - 数据完整性如何？
   - 是否支持词形变化查询？

3. **[P0] 单词点击的完整数据流是什么？**
   - 从点击到显示释义的完整链路
   - 每个环节的数据格式
   - 错误处理机制

### 中优先级（影响设计决策）
4. **[P1] 项目是否已有词汇等级/分类机制？**
   - 数据库 schema 中是否有相关字段？
   - 代码中是否有相关逻辑？
   - 是否可以复用现有机制？

5. **[P1] 阅读页面的单词渲染机制是什么？**
   - 是纯文本还是已经做了单词分割？
   - 是否已有高亮/标注机制？
   - 性能如何？

6. **[P1] 用户数据模型是否支持个性化词库？**
   - 是否有用户词汇掌握度数据？
   - 数据结构是什么？
   - 是否支持扩展？

### 低优先级（优化方向）
7. **[P2] 是否有现成的词汇分级词表可用？**
   - 法律/版权问题
   - 数据质量
   - 集成难度

8. **[P2] 颜色标注对性能的影响？**
   - 大段文本标注的性能测试
   - 优化方案（Canvas/Web Worker）

## 探索策略

### 第一轮：问题诊断（聚焦 P0）
1. 搜索单词点击相关代码（事件监听器）
2. 搜索词典查询相关代码（API/Service）
3. 搜索释义显示相关代码（组件）
4. 检查数据库 schema 和示例数据

### 第二轮：架构理解（聚焦 P1）
1. 分析阅读页面的渲染机制
2. 分析用户数据模型
3. 搜索是否已有词汇分级相关代码

### 第三轮：方案设计（基于前两轮发现）
1. 设计默认词库的数据结构
2. 设计颜色标注的实现方案
3. 评估性能影响和优化策略

## 预期产出

### 问题1诊断报告
- 根本原因定位
- 修复方案
- 测试验证

### 问题2设计方案
- 功能规格说明
- 技术实现方案
- 数据迁移计划（如需要）
- 性能优化建议
